# Unified Documentation Deployment

This guide shows how to deploy both TypeScript (proton-drive-cli) and Go (proton-git-lfs) documentation to a single unified site.

## Architecture

```
docs/
â”œâ”€â”€ index.html              # Landing page with links
â”œâ”€â”€ typescript/             # TypeDoc generated docs
â”‚   â””â”€â”€ (generated by TypeDoc)
â””â”€â”€ go/                     # Go docs (pkgsite or godoc)
    â””â”€â”€ (generated by pkgsite)
```

## Local Development

### Generate TypeScript Docs

```bash
cd submodules/proton-drive-cli
yarn docs
# Output: docs/api/
```

### Generate Go Docs

```bash
# Modern (pkgsite)
pkgsite -open .

# Or legacy (godoc)
godoc -http=:6060
```

### Serve Unified Docs Locally

```bash
# Create unified docs directory
mkdir -p docs/unified
cp -r submodules/proton-drive-cli/docs/api docs/unified/typescript
# (Go docs served live via pkgsite)

# Serve with simple HTTP server
npx http-server docs/unified -p 8080
# Or
python3 -m http.server 8080 --directory docs/unified
```

## GitHub Actions Deployment

Create `.github/workflows/docs.yml`:

```yaml
name: Documentation

on:
  push:
    branches: [main]
    paths:
      - 'submodules/proton-drive-cli/src/**'
      - 'cmd/**'
      - 'internal/**'
      - 'docs/**'
      - '.github/workflows/docs.yml'
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '25'
          cache: 'yarn'
          cache-dependency-path: submodules/proton-drive-cli/yarn.lock

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.25'
          cache: true

      - name: Enable Corepack
        run: corepack enable

      - name: Install TypeScript dependencies
        working-directory: submodules/proton-drive-cli
        run: yarn install --immutable

      - name: Generate TypeScript docs
        working-directory: submodules/proton-drive-cli
        run: yarn docs

      - name: Install pkgsite
        run: go install golang.org/x/pkgsite/cmd/pkgsite@latest

      - name: Generate Go docs
        run: |
          mkdir -p docs-build/go
          pkgsite -http=:6060 &
          PKGSITE_PID=$!
          sleep 10

          # Download Go docs
          wget -r -np -nH -P docs-build/go \
            --cut-dirs=0 \
            --reject-regex=".*\.(css|js|png|svg|ico)$" \
            --accept-regex="^/(github\.com/[^/]+/[^/]+|static/)" \
            http://localhost:6060/github.com/${GITHUB_REPOSITORY}

          # Copy static assets
          wget -r -np -nH -P docs-build/go \
            --accept-regex="^/static/" \
            http://localhost:6060/static/

          kill $PKGSITE_PID

      - name: Create unified docs
        run: |
          mkdir -p docs-build/unified

          # Copy TypeScript docs
          cp -r submodules/proton-drive-cli/docs/api docs-build/unified/typescript

          # Copy Go docs
          cp -r docs-build/go/* docs-build/unified/go/

          # Create landing page
          cat > docs-build/unified/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Proton Git LFS Documentation</title>
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                max-width: 800px;
                margin: 50px auto;
                padding: 20px;
                line-height: 1.6;
              }
              h1 { border-bottom: 2px solid #6d4aff; padding-bottom: 10px; }
              .section { margin: 30px 0; padding: 20px; background: #f5f5f5; border-radius: 8px; }
              .section h2 { margin-top: 0; color: #6d4aff; }
              a { color: #6d4aff; text-decoration: none; }
              a:hover { text-decoration: underline; }
              .badge {
                display: inline-block;
                padding: 4px 8px;
                background: #6d4aff;
                color: white;
                border-radius: 4px;
                font-size: 0.9em;
                margin-left: 10px;
              }
            </style>
          </head>
          <body>
            <h1>Proton Git LFS Documentation</h1>

            <div class="section">
              <h2>ðŸ“˜ TypeScript API Documentation <span class="badge">proton-drive-cli</span></h2>
              <p>Complete API reference for the TypeScript CLI and bridge protocol.</p>
              <ul>
                <li><a href="typescript/index.html">API Documentation</a></li>
                <li><a href="typescript/modules.html">All Modules</a></li>
                <li>Coverage: CLI Commands, Authentication, Drive Operations, Utilities</li>
              </ul>
            </div>

            <div class="section">
              <h2>ðŸ“— Go API Documentation <span class="badge">proton-git-lfs</span></h2>
              <p>Complete API reference for the Go adapter and system tray app.</p>
              <ul>
                <li><a href="go/github.com/SevenOfNine-ai/proton-git-lfs">Go Documentation</a></li>
                <li>Coverage: Git LFS Adapter, System Tray, Configuration</li>
              </ul>
            </div>

            <div class="section">
              <h2>ðŸ“š Architecture Documentation</h2>
              <p>High-level architecture and design documentation.</p>
              <ul>
                <li><a href="https://github.com/SevenOfNine-ai/proton-git-lfs/blob/main/docs/architecture/ARCHITECTURE.md">Main Architecture (Go)</a></li>
                <li><a href="https://github.com/SevenOfNine-ai/proton-drive-cli/blob/main/docs/architecture/ARCHITECTURE.md">CLI Architecture (TypeScript)</a></li>
              </ul>
            </div>

            <div class="section">
              <h2>ðŸ”§ Documentation Guides</h2>
              <ul>
                <li><a href="https://github.com/SevenOfNine-ai/proton-drive-cli/blob/main/docs/DOCUMENTATION_GUIDE.md">TypeScript Documentation Guide</a></li>
                <li><a href="https://github.com/SevenOfNine-ai/proton-git-lfs/blob/main/docs/DOCUMENTATION_GUIDE.md">Go Documentation Guide</a></li>
              </ul>
            </div>

            <footer style="margin-top: 50px; text-align: center; color: #666;">
              <p>Generated with TypeDoc and pkgsite | <a href="https://github.com/SevenOfNine-ai/proton-git-lfs">GitHub Repository</a></p>
            </footer>
          </body>
          </html>
          EOF

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: docs-build/unified

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

## Alternative: Separate Deployment

If you prefer separate documentation sites:

### TypeScript Only

```yaml
# .github/workflows/ts-docs.yml
name: TypeScript Documentation

on:
  push:
    branches: [main]
    paths:
      - 'submodules/proton-drive-cli/**'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive

      - uses: actions/setup-node@v4
        with:
          node-version: '25'
          cache: 'yarn'
          cache-dependency-path: submodules/proton-drive-cli/yarn.lock

      - run: corepack enable

      - working-directory: submodules/proton-drive-cli
        run: yarn install --immutable

      - working-directory: submodules/proton-drive-cli
        run: yarn docs

      - uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: submodules/proton-drive-cli/docs/api
          destination_dir: typescript
```

### Go via pkg.go.dev

For Go, the simplest approach is to use pkg.go.dev:

1. Push code to GitHub (public repo)
2. Documentation automatically available at:
   `https://pkg.go.dev/github.com/SevenOfNine-ai/proton-git-lfs`

No deployment needed!

## Documentation Structure

```
GitHub Pages Site
â”œâ”€â”€ index.html                          # Landing page
â”œâ”€â”€ typescript/                         # TypeDoc output
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ modules.html
â”‚   â”œâ”€â”€ classes/
â”‚   â”œâ”€â”€ functions/
â”‚   â””â”€â”€ interfaces/
â””â”€â”€ go/                                 # pkgsite output
    â””â”€â”€ github.com/
        â””â”€â”€ SevenOfNine-ai/
            â””â”€â”€ proton-git-lfs/
                â”œâ”€â”€ cmd/
                â”‚   â”œâ”€â”€ adapter/
                â”‚   â””â”€â”€ tray/
                â””â”€â”€ internal/
                    â””â”€â”€ config/
```

## Local Preview

```bash
# Full unified preview
make docs-preview

# TypeScript only
cd submodules/proton-drive-cli
yarn docs
yarn docs:serve

# Go only
pkgsite -open .
```

## Makefile Integration

Add to root `Makefile`:

```makefile
.PHONY: docs docs-ts docs-go docs-preview docs-clean

# Generate all documentation
docs: docs-ts docs-go

# Generate TypeScript docs
docs-ts:
    cd submodules/proton-drive-cli && yarn docs

# Serve Go docs locally
docs-go:
    @echo "Starting Go documentation server..."
    @echo "Visit http://localhost:6060/github.com/SevenOfNine-ai/proton-git-lfs"
    pkgsite -http=:6060

# Preview unified docs
docs-preview: docs
    @echo "Generating unified preview..."
    @mkdir -p docs-preview
    @cp -r submodules/proton-drive-cli/docs/api docs-preview/typescript
    @echo "Serving at http://localhost:8080"
    @npx http-server docs-preview -p 8080

# Clean generated docs
docs-clean:
    rm -rf submodules/proton-drive-cli/docs/api
    rm -rf docs-preview
```

## CI/CD Best Practices

### 1. Only Build on Documentation Changes

```yaml
on:
  push:
    branches: [main]
    paths:
      - 'src/**/*.ts'           # TypeScript source
      - 'cmd/**/*.go'           # Go source
      - 'internal/**/*.go'
      - 'docs/**'               # Manual docs
      - '**/*.md'               # Markdown files
```

### 2. Cache Dependencies

```yaml
- uses: actions/setup-node@v4
  with:
    node-version: '25'
    cache: 'yarn'

- uses: actions/setup-go@v5
  with:
    go-version: '1.25'
    cache: true
```

### 3. Validate Documentation

```yaml
- name: Validate TypeScript docs
  run: |
    cd submodules/proton-drive-cli
    yarn docs
    # Check for warnings
    grep -q "Warning" docs/api/*.html && exit 1 || true

- name: Validate Go docs
  run: |
    go vet ./...
    golangci-lint run --enable godot,godox
```

## Documentation URLs

After deployment:

- **Unified**: `https://<username>.github.io/<repo>/`
- **TypeScript**: `https://<username>.github.io/<repo>/typescript/`
- **Go**: `https://<username>.github.io/<repo>/go/`
- **Go (pkg.go.dev)**: `https://pkg.go.dev/github.com/<username>/<repo>`

## Maintenance

### Update Dependencies

```bash
# TypeDoc
cd submodules/proton-drive-cli
yarn add -D typedoc@latest

# pkgsite
go install golang.org/x/pkgsite/cmd/pkgsite@latest
```

### Monitor Build Status

Add badge to README.md:

```markdown
[![Documentation](https://github.com/<username>/<repo>/actions/workflows/docs.yml/badge.svg)](https://github.com/<username>/<repo>/actions/workflows/docs.yml)
```

## Troubleshooting

### TypeDoc Fails

```bash
# Clear cache
yarn cache clean
yarn install --immutable

# Check TypeScript errors
yarn lint
```

### pkgsite Fails

```bash
# Check Go modules
go mod tidy
go mod verify

# Test pkgsite locally
pkgsite -http=:6060
```

### GitHub Pages 404

1. Check repository settings â†’ Pages â†’ Source
2. Ensure branch is `gh-pages` or `main` (docs folder)
3. Wait 2-3 minutes for deployment
4. Check Actions tab for errors

## References

- [TypeDoc Documentation](https://typedoc.org/)
- [pkgsite](https://pkg.go.dev/golang.org/x/pkgsite)
- [GitHub Pages](https://pages.github.com/)
- [Go Doc Comments](https://go.dev/doc/comment)
